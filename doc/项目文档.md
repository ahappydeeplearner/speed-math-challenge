少儿速算闯关程序（Python 可执行版）项目文档

1. 项目概述

1.1 项目目标

开发一个面向少儿的速算练习程序，包含加减乘除四则运算（难度控制在 99 乘法表及其衍生的基础范围内），通过“答题驱动的动画消除玩法”提升练习兴趣与专注度。

1.2 核心玩法一句话

屏幕上不断“生成并堆叠的障碍物（如气泡/方块/怪物）”，孩子必须在输入框中回答当前给定算式：
	•	答对：消除最上方（或最危险）的障碍物并加分
	•	答错：障碍物生成速度加快/额外生成
	•	堆满：失败（Game Over）
同时统计用时，可通过“速度开关”调整节奏。

1.3 平台与交付形式
	•	语言：Python 3.x
	•	桌面可执行程序：Windows 优先（可扩展 macOS/Linux）
	•	打包方式：PyInstaller（或 Nuitka 备选）

⸻

2. 需求范围

2.1 功能范围（MVP 必做）
	1.	四则运算出题（加减乘除）
	2.	答题输入与判定（回车提交）
	3.	障碍物堆叠系统（生成、堆叠、满格失败）
	4.	答对消除 / 答错加速机制
	5.	速度开关（慢/中/快 或滑条）
	6.	计时（本局用时、最好成绩可选）
	7.	UI 动画（生成动画、消除动画、失败动画）
	8.	基础设置：启用/禁用某些运算类型、题目数量或无尽模式

2.2 非功能需求
	•	启动速度快、界面简洁、字体大、误触成本低
	•	输入体验：支持退格、自动聚焦输入框
	•	错误提示明确但不过度打击（如“再试试！”）
	•	数据本地保存（可选）：最高分/最快用时/正确率

⸻

3. 用户体验与界面流程（UI/交互说明）

3.1 主流程
	1.	开始页
	•	“开始游戏”
	•	运算类型选择：加/减/乘/除（多选）
	•	难度：基础 / 提升（或“最大数值范围”）
	•	速度开关：慢/中/快（影响生成速度与计时节奏）
	2.	游戏页
	•	顶部：计时、分数、当前速度
	•	中部：题目显示区（大字号）：例如 7 × 8 = ?
	•	下部：输入框 + 提交按钮（回车也可）
	•	侧边/背景：障碍物堆叠区（从下往上堆叠）
	3.	结束页
	•	结果：用时、答对数、正确率、最高记录
	•	按钮：再来一局 / 返回首页

3.2 “障碍物消除”动画建议（你可以选一种实现）

机制上统一叫 Obstacle，具体视觉你来定。

方案 A：气泡堆叠（推荐）
	•	气泡从底部浮起后停在“堆叠区”形成一列
	•	答对：最上方气泡爆裂（粒子/缩放消失）
	•	答错：气泡生成间隔缩短（更快冒泡）

方案 B：方块堆叠
	•	方块从上方落下堆叠
	•	答对：消除最上层方块并播放碎裂
	•	答错：落块速度变快或一次落两块

方案 C：小怪物入侵
	•	怪物从底部爬上来排队
	•	答对：最前面的怪物被“击退”
	•	答错：怪物走得更快或同时出现更多

3.3 失败条件
	•	堆叠区达到最大容量（例如 10 个障碍物）
	•	触发失败动画 + 停止生成 + 显示统计

⸻

4. 出题规则（题库与难度控制）

4.1 数值范围（默认建议）
	•	加法：0–99（可限制结果 ≤ 100）
	•	减法：0–99（保证非负结果，或允许负数作为提升难度开关）
	•	乘法：1–9 × 1–9（严格 99 表）
	•	除法：确保整除（如 56 ÷ 7），商在 1–9 或 1–12

4.2 题目生成策略（先简单后扩展）
	•	随机生成（MVP）：均匀随机 + 去重（可选）
	•	自适应扩展（后续）：根据错误题型提高出现频率

4.3 判题规则
	•	输入必须是整数（MVP），除法输出为整数
	•	支持跳过题（可选）：跳过相当于答错或扣分

⸻

5. 游戏规则与数值设计

5.1 核心参数（建议给默认值）
	•	max_stack = 10（堆满失败）
	•	spawn_interval_base = 2.0s（基础生成间隔）
	•	spawn_interval_min = 0.5s（最小间隔）
	•	wrong_penalty = 0.15s（答错让间隔减少/或额外+1障碍物）
	•	correct_reward = 1（答对消除数量，通常 1 个）
	•	speed_multiplier（速度开关：0.8 / 1.0 / 1.2）

5.2 答对/答错效果（明确、可调）
	•	答对：
	•	消除最上方障碍物（若为空则给奖励分）
	•	分数 +1（或连击加成）
	•	答错：
	•	本次不消除
	•	生成速度提升：spawn_interval = max(min, spawn_interval - wrong_penalty)
	•	或直接追加生成 1 个障碍物（更直观）

5.3 时间与结算
	•	无尽模式：坚持越久越好（用时越长越好）
	•	闯关模式（可选）：固定题数/固定目标分数，用时越短越好

⸻

6. 技术方案（Python + UI + 打包）

6.1 UI 技术选型建议

你后续会加 UI 和算法，我先给两套主流路线（你选其一即可）：

路线 1：PyQt / PySide（推荐桌面质感）
	•	优点：控件强、动画/定时器成熟、打包稳定
	•	动画：QPropertyAnimation、QGraphicsView 场景

路线 2：Pygame（更像游戏）
	•	优点：做“堆叠/消除/粒子”非常自然
	•	输入框需要自己实现或用简单文本输入

如果你想“UI 动画消除 + 生成堆叠”像小游戏，Pygame 更顺；
如果你想偏“练习软件 + 动画点缀”，PyQt 更顺。

6.2 打包方案
	•	PyInstaller：一键 --onefile / --noconsole
	•	资源文件：图片/音效用相对路径 + 打包 spec 配置
	•	版本号与更新：后续可加

⸻

7. 系统架构设计（模块划分）

7.1 模块列表
	1.	core/ 游戏核心
	•	question_generator.py：出题与答案计算
	•	game_state.py：分数、时间、堆叠状态、速度状态
	•	rules.py：答对/答错对状态的影响（可调参数集中）
	2.	ui/ 界面层（你来实现）
	•	main_menu.py
	•	game_view.py
	•	result_view.py
	•	animations.py
	3.	assets/ 资源（图片、音效、字体）
	4.	config/
	•	default.json：默认参数（max_stack、速度档位等）
	5.	storage/
	•	records.json：历史最好成绩
	6.	main.py：程序入口

7.2 事件与数据流（关键）
	•	UI 层负责：渲染、动画、接收输入
	•	Core 层负责：生成题目、判题、更新状态
	•	UI 每帧/每 tick：
	1.	判断是否到达生成时间 → core 生成障碍物
	2.	渲染障碍物堆叠
	3.	若用户提交答案 → core 判题 → 返回“正确/错误/消除数量/速度变化”等结果 → UI 播放对应动画

⸻

8. 数据结构与接口（给你接 UI 的“契约”）

8.1 Question（题目对象）
	•	字段：
	•	text: “7 × 8 = ?”
	•	answer: 56
	•	op: “+/-/*//”
	•	a, b: 操作数
	•	difficulty_tag: “basic”/“advanced”（可选）

8.2 GameState（游戏状态）
	•	字段：
	•	stack_count: 当前障碍物数量
	•	max_stack
	•	score
	•	start_time, elapsed_time
	•	spawn_interval
	•	speed_mode: slow/normal/fast
	•	current_question

8.3 Core 接口示例（供 UI 调用）
	•	new_game(settings) -> GameState
	•	tick(dt) -> events
	•	events 可能包含：spawn_obstacle, game_over
	•	submit_answer(user_input) -> result
	•	result 包含：is_correct, delta_stack, delta_score, new_spawn_interval, next_question

你做 UI 时，只要按这个接口接，就能把动画与逻辑分离，后期改规则也不痛苦。

⸻

9. 配置项（可调参数清单）
	•	运算类型启用：add/sub/mul/div
	•	数值范围：max_add, max_sub, mul_range, div_range
	•	堆叠上限：max_stack
	•	生成间隔：spawn_interval_base / spawn_interval_min
	•	答错惩罚：wrong_penalty（减少间隔）或 wrong_spawn_extra（额外生成）
	•	速度档位：slow/normal/fast 对应 multiplier
	•	音效开关、全屏开关（可选）

⸻

10. 测试计划（MVP）

10.1 单元测试（Core）
	•	乘法题：1–9 × 1–9 正确答案
	•	除法题：确保整除，答案为整数
	•	减法题：默认不出负数
	•	速度惩罚：答错后 spawn_interval 不低于 min
	•	堆叠失败：stack_count 达到 max_stack 触发 game_over

10.2 体验测试
	•	输入框是否始终聚焦
	•	回车提交是否可用
	•	答对/答错动画是否对应触发
	•	速度开关对生成节奏是否明显

⸻

11. 里程碑计划（建议）
	1.	Week 1：Core（出题/判题/状态机/堆叠规则）+ 简陋 UI（能玩）
	2.	Week 2：动画与音效、速度开关、结果统计
	3.	Week 3：打包发布、配置文件、记录保存、优化体验

⸻

12. 你需要补充的内容（留给你做 UI + 算法设计）
	•	UI 风格稿：障碍物形象、消除动画方式、布局
	•	难度算法：自适应策略、题目权重、连击/奖励
	•	关卡模式：第 N 关增加哪种运算/速度/范围
